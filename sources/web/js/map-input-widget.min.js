function MapInputWidgetManager(){var widgets=Array(),initializeWidget=function(widgetContainer){if(!$(widgetContainer).data("initialized")){var widget=new MapInputWidget(widgetContainer);return widget.initialize(),widget}return null},addWidget=function(widget){var widgetId=widget.getId();widgets[widgetId]=widget};this.initializeWidgets=function(){$(".hector68-map-input-widget").each(function(widgetIndex,widgetContainer){var widget=initializeWidget(widgetContainer);widget&&addWidget(widget)})},this.getWidget=function(widgetId){return widgets[widgetId]}}function MapInputWidget(widget){var input,searchBar,canvas,map,self=this,initializeComponents=function(){input=$(widget).find("input.hector68-map-input-widget-input").get(0),searchBar=$(widget).find("input.hector68-map-input-widget-search-bar").get(0),canvas=$(widget).find("div.hector68-map-input-widget-canvas").get(0)},initializeMap=function(){map=new google.maps.Map(canvas,{mapTypeId:$(widget).data("map-type"),center:getInitialMapCenter(),zoom:$(widget).data("zoom"),styles:[{featureType:"poi",stylers:[{visibility:"off"}]}],mapTypeControlOptions:{mapTypeIds:[]}}),1!==$(widget).data("readonly")&&google.maps.event.addListener(map,"click",function(click){self.setPosition({latitude:click.latLng.lat(),longitude:click.latLng.lng()})})},initializeWidget=function(){var point=getInitialValue();self.setPosition(point),$(widget).data("initialized",!0)},initializeSearchBar=function(){var searchBarIsHidden=!$(widget).data("enable-search-bar");$(searchBar).prop("hidden",searchBarIsHidden),searchBarAutocomplete=new google.maps.places.Autocomplete(searchBar),map.controls[google.maps.ControlPosition.TOP_LEFT].push(searchBar),google.maps.event.addListener(searchBarAutocomplete,"place_changed",function(){var placeGeometry=this.getPlace().geometry;if(placeGeometry){var placeLocation=placeGeometry.location;self.setPosition(placeLocation)}}),google.maps.event.addDomListener(searchBar,"keydown",function(e){13==e.keyCode&&e.preventDefault()})},makePointString=function(pointData){var pattern=getPattern(),point=makePoint(pointData);return pattern=pattern.replace(/%latitude%/g,point.lat()),pattern=pattern.replace(/%longitude%/g,point.lng())},hasInitialValue=function(){return""!=$(input).prop("value")},getInitialValue=function(){var point,pattern=getPattern(),pointString=$(input).prop("value");if(""!==pointString){var latitudeFirst=pattern.indexOf("%latitude%")<pattern.indexOf("%longitude%"),latitudeIndex=latitudeFirst?0:1,longitudeIndex=latitudeFirst?1:0,latitude=pointString.match(/-?\d+(\.\d+)?/g)[latitudeIndex],longitude=pointString.match(/-?\d+(\.\d+)?/g)[longitudeIndex];point=new google.maps.LatLng(latitude,longitude)}else point=null;return point},getInitialCenter=function(){var latitude=$(widget).data("latitude"),longitude=$(widget).data("longitude");return new google.maps.LatLng(latitude,longitude)},getInitialMapCenter=function(){return hasInitialValue()?getInitialValue():getInitialCenter()},getPattern=function(){return $(widget).attr("data-pattern").toString()},makePoint=function(pointData){var point;if(void 0!==pointData.latitude&&void 0!==pointData.longitude){var latitude=pointData.latitude,longitude=pointData.longitude;point=new google.maps.LatLng(latitude,longitude)}else point=pointData;return point};this.initialize=function(){var eventInitializeBefore=jQuery.Event("initializeBefore");eventInitializeBefore.MapInputWidget=this,$(widget).trigger(eventInitializeBefore),initializeComponents(),initializeMap(),initializeWidget(),initializeSearchBar();var eventInitializeAfter=jQuery.Event("initializeAfter");eventInitializeAfter.MapInputWidget=this,$(widget).trigger(eventInitializeAfter)},this.getId=function(){return $(widget).prop("id")},this.setPosition=function(pointData){if(map.marker&&map.marker.setMap(null),null!==pointData){$(input).prop("disabled",!1);var point=makePoint(pointData);1===$(widget).data("align-map-center")&&map.panTo(point);var markerAnimation=null;1===$(widget).data("animate-marker")&&(markerAnimation=google.maps.Animation.DROP),map.marker=new google.maps.Marker({map:map,position:point,draggable:1!==$(widget).data("readonly"),animation:markerAnimation}),1!==$(widget).data("readonly")&&google.maps.event.addListener(map.marker,"dragend",function(){self.setPosition(this.getPosition())});$(widget).data("pattern");var event=jQuery.Event("makePoint");event.pointString=makePointString(point),event.MapInputWidget=this,$(widget).trigger(event),$(input).prop("value",event.pointString)}else $(input).prop("disabled",!0)},this.panTo=function(pointData){var point=makePoint(pointData);map.panTo(point)},this.setZoom=function(zoom){map.setZoom(zoom)},this.getMap=function(){return map},this.getSearchBar=function(){return searchBar},this.getInput=function(){return input}}